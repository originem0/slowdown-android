# ç»Ÿè®¡é¡µé‡æ„è®¾è®¡ï¼šæ•°æ®å™äº‹ä¼˜åŒ–

## æ¦‚è¿°

æœ¬æ¬¡é‡æ„çš„æ ¸å¿ƒç†å¿µæ˜¯**ä»"å±•ç¤ºæ•°æ®"åˆ°"è®²è¿°è¡Œä¸ºæ•…äº‹"**ã€‚é€šè¿‡åˆ©ç”¨å·²å­˜å‚¨ä½†æœªå±•ç¤ºçš„ `actualWaitTime` æ•°æ®ï¼Œå¹¶æ–°å¢æ—¶æ®µåˆ†æï¼Œå¸®åŠ©ç”¨æˆ·æ›´å¥½åœ°ç†è§£è‡ªå·±çš„è¡Œä¸ºæ¨¡å¼ã€‚

## ç›®æ ‡

1. **æå‡è§‰å¯Ÿè´¨é‡æ„ŸçŸ¥** - é€šè¿‡"å¹³å‡å†³ç­–æ—¶é—´"è®©ç”¨æˆ·äº†è§£è‡ªå·±çš„å†³ç­–è´¨é‡
2. **è¯†åˆ«è¡Œä¸ºæ¨¡å¼** - é€šè¿‡æ—¶æ®µåˆ†å¸ƒå¸®åŠ©ç”¨æˆ·å‘ç°é«˜å±æ—¶æ®µ
3. **å¢å¼ºè¶‹åŠ¿æ„ŸçŸ¥** - é€šè¿‡åŒæŒ‡æ ‡å‘¨è¶‹åŠ¿å’Œæœˆå¯¹æ¯”æä¾›è¿›æ­¥åé¦ˆ

## ä¸æ”¹å˜çš„éƒ¨åˆ†

- æˆåŠŸç‡çš„è®¡ç®—é€»è¾‘å’Œæ–‡æ¡ˆ
- Statistics é¡µçš„ä½¿ç”¨æ—¶é•¿é¥¼å›¾
- æ­£å¿µå‘¼å¸åœˆåŠ¨ç”»

---

## Dashboard é¡µé¢æ”¹åŠ¨

### æ–°å¢æŒ‡æ ‡ï¼šå¹³å‡å†³ç­–æ—¶é—´

**ä½ç½®**ï¼šStatsOverview åŒºåŸŸï¼Œä¸"ä»Šæ—¥æ‹¦æˆª"ã€"æˆåŠŸç‡"å¹¶åˆ—

**æ•°æ®æ¥æº**ï¼š
```kotlin
// InterventionDao æ–°å¢
@Query("SELECT AVG(actualWaitTime) FROM intervention_records WHERE timestamp >= :startTime")
fun getAverageDecisionTime(startTime: Long): Flow<Float?>
```

**å±•ç¤ºæ ¼å¼**ï¼š`X.X ç§’` æˆ– `-- ç§’`ï¼ˆæ— æ•°æ®æ—¶ï¼‰

**å¸ƒå±€è°ƒæ•´**ï¼šä¸‰ä¸ªæŒ‡æ ‡æ¨ªå‘æ’åˆ—ï¼Œç”¨ç«–çº¿åˆ†éš”
```
  ä»Šæ—¥æ‹¦æˆª  |  æˆåŠŸç‡  |  å†³ç­–æ—¶é—´
     12    |   67%   |   4.2ç§’
```

### è§‰çŸ¥æ—¶åˆ»æ”¹åŠ¨

**å½“å‰æ ¼å¼**ï¼š
> ğŸŒ¿ 18:12 åœ¨æŠ–éŸ³æ·±å‘¼å¸åé€‰æ‹©ç¦»å¼€

**æ–°æ ¼å¼**ï¼š
> ğŸŒ¿ 18:12 åœ¨æŠ–éŸ³ç­‰å¾… 8 ç§’åé€‰æ‹©ç¦»å¼€
> ğŸŒ¿ 16:45 åœ¨Bç«™ç­‰å¾… 2 ç§’åç»§ç»­ä½¿ç”¨

**å±•å¼€åŠŸèƒ½**ï¼š
- é»˜è®¤æ˜¾ç¤º 3 æ¡
- åº•éƒ¨æ·»åŠ "æŸ¥çœ‹å…¨éƒ¨"æŒ‰é’®
- ç‚¹å‡»åå±•å¼€æ˜¾ç¤ºä»Šæ—¥å…¨éƒ¨è®°å½•

### Dashboard å¸ƒå±€é¡ºåº

1. çŠ¶æ€å¤´éƒ¨ï¼ˆä¿æŠ¤å¼€å…³ï¼‰
2. æ­£å¿µå‘¼å¸åœˆ + ä»Šæ—¥æ‹¦æˆª/æˆåŠŸç‡/å¹³å‡å†³ç­–æ—¶é—´
3. è§‰çŸ¥æ—¶åˆ»ï¼ˆ3æ¡ + å±•å¼€æŒ‰é’®ï¼‰
4. æ—¶æ®µåˆ†å¸ƒæ¡ï¼ˆæ–°å¢ï¼‰
5. æœ€å¸¸æ‹¦æˆªåº”ç”¨ Top 5

---

## æ—¶æ®µåˆ†å¸ƒç»„ä»¶ï¼ˆæ–°å¢ï¼‰

### ä½ç½®
Dashboard é¡µé¢ï¼Œåœ¨"è§‰çŸ¥æ—¶åˆ»"ä¹‹åã€"æœ€å¸¸æ‹¦æˆªåº”ç”¨"ä¹‹å‰

### æ•°æ®æ¥æº
```kotlin
// InterventionDao æ–°å¢
data class HourlyStat(val hour: Int, val count: Int)

@Query("""
    SELECT
        CAST(strftime('%H', datetime(timestamp/1000, 'unixepoch', 'localtime')) AS INTEGER) as hour,
        COUNT(*) as count
    FROM intervention_records
    WHERE timestamp >= :startTime
    GROUP BY hour
""")
fun getHourlyDistribution(startTime: Long): Flow<List<HourlyStat>>
```

### æ—¶æ®µåˆ’åˆ†

| æ—¶æ®µ | å°æ—¶èŒƒå›´ | æ ‡ç­¾ |
|------|----------|------|
| ä¸Šåˆ | 6:00 - 11:59 | ä¸Šåˆ |
| ä¸‹åˆ | 12:00 - 17:59 | ä¸‹åˆ |
| æ™šä¸Š | 18:00 - 23:59 | æ™šä¸Š |
| æ·±å¤œ | 0:00 - 5:59 | æ·±å¤œ |

### UI è®¾è®¡
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“Š ä»Šæ—¥æ—¶æ®µåˆ†å¸ƒ                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ä¸Šåˆ  â–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  3æ¬¡         â”‚
â”‚  ä¸‹åˆ  â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘  5æ¬¡         â”‚
â”‚  æ™šä¸Š  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘  12æ¬¡ ğŸ”¥     â”‚
â”‚  æ·±å¤œ  â–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  2æ¬¡         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

- æœ€é«˜æ¬¡æ•°çš„æ—¶æ®µæ ‡è®° ğŸ”¥ å›¾æ ‡
- è¿›åº¦æ¡é¢œè‰²ä½¿ç”¨ `MaterialTheme.colorScheme.primary`
- æ— æ•°æ®æ—¶æ˜¾ç¤º"æš‚æ— æ•°æ®"

---

## Statistics é¡µé¢æ”¹åŠ¨

### å‘¨è¶‹åŠ¿ï¼šåŒæŒ‡æ ‡è®¾è®¡

**å½“å‰**ï¼šå•ä¸€æŸ±çŠ¶å›¾æ˜¾ç¤ºæ¯æ—¥ä½¿ç”¨æ—¶é•¿

**æ”¹ä¸º**ï¼šä¿ç•™æŸ±çŠ¶å›¾ï¼Œæ–°å¢æ‹¦æˆªæ¬¡æ•°æŠ˜çº¿

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“ˆ æœ¬å‘¨è¶‹åŠ¿                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚     ä½¿ç”¨æ—¶é•¿(æŸ±) â–   æ‹¦æˆªæ¬¡æ•°(çº¿) â—   â”‚
â”‚                                     â”‚
â”‚  120åˆ† â”¤    â–ˆâ–ˆ                      â”‚
â”‚   90åˆ† â”¤ â–ˆâ–ˆ â–ˆâ–ˆ â—â”€â—                  â”‚
â”‚   60åˆ† â”¤ â–ˆâ–ˆ â–ˆâ–ˆ â–ˆâ–ˆ â—  â–ˆâ–ˆ            â”‚
â”‚   30åˆ† â”¤ â–ˆâ–ˆ â–ˆâ–ˆ â–ˆâ–ˆ â–ˆâ–ˆ â–ˆâ–ˆ â—â”€â—        â”‚
â”‚        â””â”€ä¸€â”€äºŒâ”€ä¸‰â”€å››â”€äº”â”€å…­â”€æ—¥â”€â”€     â”‚
â”‚                                     â”‚
â”‚  æœ¬å‘¨æ€»è®¡ï¼š8å°æ—¶32åˆ† | æ‹¦æˆª28æ¬¡      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ•°æ®æ¥æº**ï¼š
- ä½¿ç”¨æ—¶é•¿ï¼šç°æœ‰ `UsageRecord`
- æ‹¦æˆªæ¬¡æ•°ï¼š`InterventionDao.getDailyStats()`

### æœˆå¯¹æ¯”ï¼ˆæ›¿ä»£åŸ"æœ¬æœˆæ€»è®¡"ï¼‰

**å½“å‰**ï¼š
> æœ¬æœˆæ€»ä½¿ç”¨ï¼š32å°æ—¶

**æ”¹ä¸º**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“… æœˆåº¦å¯¹æ¯”                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æœ¬æœˆ vs ä¸ŠæœˆåŒæœŸï¼š                  â”‚
â”‚  â€¢ ä½¿ç”¨æ—¶é•¿ï¼š28h â†’ 24h (â†“14%)       â”‚
â”‚  â€¢ æ‹¦æˆªæ¬¡æ•°ï¼š86 â†’ 72 (â†“16%)         â”‚
â”‚  â€¢ æˆåŠŸç‡ï¼š62% â†’ 68% (â†‘6%)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**è®¡ç®—é€»è¾‘**ï¼šæ¯”è¾ƒæœ¬æœˆ1æ—¥è‡³ä»Š vs ä¸Šæœˆ1æ—¥è‡³åŒä¸€å¤©

---

## æ•°æ®å±‚æ”¹åŠ¨

### InterventionDao æ–°å¢æ–¹æ³•

```kotlin
// å¹³å‡å†³ç­–æ—¶é—´
@Query("SELECT AVG(actualWaitTime) FROM intervention_records WHERE timestamp >= :startTime")
fun getAverageDecisionTime(startTime: Long): Flow<Float?>

// æ—¶æ®µåˆ†å¸ƒ
data class HourlyStat(val hour: Int, val count: Int)

@Query("""
    SELECT
        CAST(strftime('%H', datetime(timestamp/1000, 'unixepoch', 'localtime')) AS INTEGER) as hour,
        COUNT(*) as count
    FROM intervention_records
    WHERE timestamp >= :startTime
    GROUP BY hour
""")
fun getHourlyDistribution(startTime: Long): Flow<List<HourlyStat>>

// æœˆåº¦ç»Ÿè®¡ï¼ˆæŒ‡å®šæ—¥æœŸèŒƒå›´ï¼‰
@Query("""
    SELECT COUNT(*) FROM intervention_records
    WHERE timestamp >= :startTime AND timestamp < :endTime
""")
suspend fun getCountBetween(startTime: Long, endTime: Long): Int

@Query("""
    SELECT SUM(CASE WHEN userChoice != 'continued' THEN 1 ELSE 0 END) * 100 / COUNT(*)
    FROM intervention_records
    WHERE timestamp >= :startTime AND timestamp < :endTime
""")
suspend fun getSuccessRateBetween(startTime: Long, endTime: Long): Int?
```

### ViewModel æ”¹åŠ¨

**DashboardViewModel æ–°å¢**ï¼š
- `averageDecisionTime: StateFlow<Float?>`
- `hourlyDistribution: StateFlow<List<PeriodStat>>`ï¼ˆèšåˆä¸º4æ—¶æ®µï¼‰
- `allTodayMoments: StateFlow<List<AwarenessMoment>>`ï¼ˆå±•å¼€ç”¨ï¼‰

**StatisticsViewModel æ–°å¢**ï¼š
- `weeklyInterventionCounts: StateFlow<List<DailyStat>>`
- `monthComparison: StateFlow<MonthComparisonData>`

---

## å®ç°ä¼˜å…ˆçº§

| ä¼˜å…ˆçº§ | ä»»åŠ¡ | æ¶‰åŠæ–‡ä»¶ |
|--------|------|----------|
| P0 | Dashboard æ·»åŠ "å¹³å‡å†³ç­–æ—¶é—´" | InterventionDao, DashboardViewModel, DashboardScreen |
| P0 | è§‰çŸ¥æ—¶åˆ»æ˜¾ç¤ºç­‰å¾…æ—¶é—´ + å±•å¼€æŒ‰é’® | DashboardViewModel, DashboardScreen |
| P1 | æ—¶æ®µåˆ†å¸ƒç»„ä»¶ | InterventionDao, DashboardViewModel, DashboardScreenï¼ˆæ–°ç»„ä»¶ï¼‰ |
| P1 | å‘¨è¶‹åŠ¿åŒæŒ‡æ ‡ | StatisticsViewModel, StatisticsScreen, HorizontalBarChart |
| P2 | æœˆåº¦å¯¹æ¯” | InterventionDao, StatisticsViewModel, StatisticsScreen |

## éœ€è¦æ–°å»ºçš„æ–‡ä»¶

- `ui/components/PeriodDistributionChart.kt` - æ—¶æ®µåˆ†å¸ƒç»„ä»¶

## éœ€è¦ä¿®æ”¹çš„æ–‡ä»¶

- `data/local/dao/InterventionDao.kt`
- `viewmodel/DashboardViewModel.kt`
- `viewmodel/StatisticsViewModel.kt`
- `ui/screen/DashboardScreen.kt`
- `ui/screen/StatisticsScreen.kt`
- `ui/components/HorizontalBarChart.kt`ï¼ˆæ”¯æŒåŒæŒ‡æ ‡ï¼‰

## é£é™©ä¸æ³¨æ„äº‹é¡¹

1. **actualWaitTime æ•°æ®è´¨é‡** - éœ€ç¡®è®¤ OverlayActivity æ­£ç¡®è®°å½•è¯¥å­—æ®µ
2. **æ€§èƒ½** - æ—¶æ®µåˆ†å¸ƒæŸ¥è¯¢éœ€è¦æŒ‰å°æ—¶èšåˆï¼Œæ•°æ®é‡å¤§æ—¶æ³¨æ„ä¼˜åŒ–
3. **å›½é™…åŒ–** - æ–°å¢æ–‡æ¡ˆéœ€åŒæ—¶æ›´æ–° values/strings.xml å’Œ values-zh/strings.xml

---

*è®¾è®¡æ—¥æœŸï¼š2026-01-20*
