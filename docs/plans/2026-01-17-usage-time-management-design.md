# ç¬¬äºŒé˜¶æ®µåŠŸèƒ½è®¾è®¡ï¼šä½¿ç”¨æ—¶é—´ç®¡ç†

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:executing-plans to implement this plan task-by-task.

**Goal:** å®ç°åº”ç”¨ä½¿ç”¨æ—¶é—´è¿½è¸ªã€é™é¢è®¾ç½®ã€åˆ°ç‚¹æé†’åŠŸèƒ½ï¼Œå¸®åŠ©ç”¨æˆ·å¥åº·ä½¿ç”¨æ‰‹æœº

**Architecture:** æ··åˆè¿½è¸ªæ¨¡å¼ï¼ˆUsageStats + å®æ—¶ç›‘æ§ï¼‰+ Room æ•°æ®åº“å­˜å‚¨ + Compose UI

**Tech Stack:** Kotlin, Jetpack Compose, Room, UsageStatsManager, AccessibilityService

---

## åŠŸèƒ½æ¦‚è¿°

### æ ¸å¿ƒåŠŸèƒ½

1. **ä½¿ç”¨æ—¶é—´è¿½è¸ª**ï¼šè®°å½•æ¯ä¸ªè¢«ç›‘æ§åº”ç”¨çš„å‰å°ä½¿ç”¨æ—¶é•¿
2. **æ—¶é—´é™é¢è®¾ç½®**ï¼šä¸ºä¸åŒåº”ç”¨è®¾ç½®æ¯æ—¥å¯ç”¨æ—¶é—´
3. **æé†’æœºåˆ¶**ï¼š80% å’Œ 100% æ—¶å¼¹çª—æé†’
4. **è¶…æ—¶å¤„ç†**ï¼šç”¨æˆ·å¯é…ç½®è½¯æé†’æˆ–å¼ºåˆ¶å…³é—­æ¨¡å¼

### æ•°æ®å±•ç¤º

1. **åº”ç”¨åˆ—è¡¨è¿›åº¦æ¡**ï¼šæ˜¾ç¤ºä»Šæ—¥ä½¿ç”¨è¿›åº¦
2. **ç»Ÿè®¡é¡µé¢**ï¼šä»Šæ—¥/æœ¬å‘¨/æœ¬æœˆä½¿ç”¨æ•°æ®å›¾è¡¨

---

## æ•°æ®æ¨¡å‹è®¾è®¡

### 1. æ‰©å±• MonitoredApp è¡¨

```kotlin
@Entity(tableName = "monitored_apps")
data class MonitoredApp(
    @PrimaryKey val packageName: String,
    val appName: String,
    val isEnabled: Boolean = true,
    val countdownSeconds: Int = 10,
    val redirectPackage: String? = null,
    // æ–°å¢å­—æ®µ
    val dailyLimitMinutes: Int? = null,  // æ¯æ—¥é™é¢ï¼ˆåˆ†é’Ÿï¼‰ï¼Œnull = æ— é™åˆ¶
    val limitMode: String = "soft"        // "soft" = è½¯æé†’, "strict" = å¼ºåˆ¶å…³é—­
)
```

### 2. æ–°å¢ UsageRecord è¡¨

```kotlin
@Entity(
    tableName = "usage_records",
    primaryKeys = ["packageName", "date"]
)
data class UsageRecord(
    val packageName: String,
    val date: String,              // "2026-01-17" æ ¼å¼
    val usageMinutes: Int = 0,     // å½“æ—¥ç´¯è®¡ä½¿ç”¨åˆ†é’Ÿ
    val lastUpdated: Long = 0      // æœ€åæ›´æ–°æ—¶é—´æˆ³
)
```

### 3. DAO æ–°å¢æ–¹æ³•

```kotlin
@Dao
interface UsageRecordDao {
    @Query("SELECT * FROM usage_records WHERE packageName = :pkg AND date = :date")
    suspend fun getRecord(pkg: String, date: String): UsageRecord?

    @Insert(onConflict = OnConflictStrategy.REPLACE)
    suspend fun upsert(record: UsageRecord)

    @Query("SELECT * FROM usage_records WHERE packageName = :pkg ORDER BY date DESC LIMIT :days")
    fun getRecentRecords(pkg: String, days: Int): Flow<List<UsageRecord>>

    @Query("SELECT * FROM usage_records WHERE date = :date")
    fun getTodayRecords(date: String): Flow<List<UsageRecord>>
}
```

---

## æ—¶é—´è¿½è¸ªæœºåˆ¶

### æ··åˆè¿½è¸ªç­–ç•¥

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      UsageStats åŒæ­¥                         â”‚
â”‚                     ï¼ˆæ¯ 5 åˆ†é’Ÿä¸€æ¬¡ï¼‰                         â”‚
â”‚                           â”‚                                  â”‚
â”‚                           â–¼                                  â”‚
â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚            â”‚  å½“å‰ä½¿ç”¨ >= 70% é™é¢ï¼Ÿ   â”‚                      â”‚
â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚                    â”‚              â”‚                          â”‚
â”‚                   å¦              æ˜¯                          â”‚
â”‚                    â”‚              â”‚                          â”‚
â”‚                    â–¼              â–¼                          â”‚
â”‚            ç»§ç»­ UsageStats    å¯åŠ¨å®æ—¶ç›‘æ§                    â”‚
â”‚                              ï¼ˆæ¯ç§’æ›´æ–°ï¼‰                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1. åå° UsageStats åŒæ­¥

```kotlin
class UsageTrackingService : Service() {
    private val handler = Handler(Looper.getMainLooper())
    private val syncInterval = 5 * 60 * 1000L  // 5 åˆ†é’Ÿ

    private val syncRunnable = object : Runnable {
        override fun run() {
            syncUsageStats()
            handler.postDelayed(this, syncInterval)
        }
    }

    private fun syncUsageStats() {
        val usageStatsManager = getSystemService(USAGE_STATS_SERVICE) as UsageStatsManager
        val endTime = System.currentTimeMillis()
        val startTime = getTodayStartTime()

        val stats = usageStatsManager.queryUsageStats(
            UsageStatsManager.INTERVAL_DAILY, startTime, endTime
        )

        // æ›´æ–°æ•°æ®åº“ä¸­çš„ä½¿ç”¨è®°å½•
        for (stat in stats) {
            val minutes = (stat.totalTimeInForeground / 1000 / 60).toInt()
            repository.updateUsageRecord(stat.packageName, minutes)
        }

        // æ£€æŸ¥æ˜¯å¦éœ€è¦å¯åŠ¨å®æ—¶ç›‘æ§
        checkRealtimeMonitoringTrigger()
    }
}
```

### 2. å®æ—¶ç›‘æ§ï¼ˆAccessibilityService æ‰©å±•ï¼‰

```kotlin
// åœ¨ AppMonitorService ä¸­æ·»åŠ 
private var realtimeTrackingEnabled = false
private var currentForegroundApp: String? = null
private var foregroundStartTime: Long = 0

override fun onAccessibilityEvent(event: AccessibilityEvent?) {
    // ... ç°æœ‰çš„å¹²é¢„é€»è¾‘ ...

    // å®æ—¶è¿½è¸ªé€»è¾‘
    if (realtimeTrackingEnabled && event?.eventType == TYPE_WINDOW_STATE_CHANGED) {
        val newForegroundApp = event.packageName?.toString()
        if (newForegroundApp != currentForegroundApp) {
            // è®°å½•ä¸Šä¸€ä¸ªåº”ç”¨çš„ä½¿ç”¨æ—¶é—´
            recordUsageTime(currentForegroundApp, foregroundStartTime)
            // æ›´æ–°å½“å‰å‰å°åº”ç”¨
            currentForegroundApp = newForegroundApp
            foregroundStartTime = System.currentTimeMillis()
        }
    }
}
```

### 3. æé†’è§¦å‘ç‚¹

| è§¦å‘æ¡ä»¶ | åŠ¨ä½œ |
|---------|------|
| ä½¿ç”¨æ—¶é—´ >= 70% é™é¢ | å¯åŠ¨å®æ—¶ç›‘æ§ |
| ä½¿ç”¨æ—¶é—´ >= 80% é™é¢ | æ˜¾ç¤º 80% æé†’å¼¹çª— |
| ä½¿ç”¨æ—¶é—´ >= 100% é™é¢ | æ ¹æ®æ¨¡å¼æ˜¾ç¤º 100% å¼¹çª— |

---

## UI è®¾è®¡

### 1. åº”ç”¨åˆ—è¡¨é¡µæ”¹è¿›

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [å›¾æ ‡] æŠ–éŸ³                              [å¼€å…³] â”‚
â”‚         ä»Šæ—¥ 15/30 åˆ†é’Ÿ                         â”‚
â”‚         [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 50%              â”‚
â”‚         å€’è®¡æ—¶: 5ç§’ | å¼ºåˆ¶å…³é—­                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [å›¾æ ‡] å¾®åš                              [å¼€å…³] â”‚
â”‚         ä»Šæ—¥ 8 åˆ†é’Ÿ (æ— é™åˆ¶)                    â”‚
â”‚         å€’è®¡æ—¶: 10ç§’ | è·³è½¬: å¾®ä¿¡è¯»ä¹¦            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. åº”ç”¨è¯¦æƒ…è®¾ç½®é¡µ

ç‚¹å‡»åº”ç”¨å¡ç‰‡åçš„è®¾ç½®é¡µé¢ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â† æŠ–éŸ³ è®¾ç½®                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å¹²é¢„è®¾ç½®                                      â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€         â”‚
â”‚  å€’è®¡æ—¶        [====â—========] 5ç§’             â”‚
â”‚  è·³è½¬åº”ç”¨      [å¾®ä¿¡è¯»ä¹¦ â–¼]                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ—¶é—´é™åˆ¶                                      â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€         â”‚
â”‚  æ¯æ—¥é™é¢      [====â—========] 30åˆ†é’Ÿ          â”‚
â”‚                â—‹ æ— é™åˆ¶                        â”‚
â”‚                                                â”‚
â”‚  è¶…æ—¶æ¨¡å¼                                      â”‚
â”‚    â—‹ è½¯æé†’ï¼ˆå…è®¸ç»§ç»­ä½¿ç”¨ï¼‰                    â”‚
â”‚    â— å¼ºåˆ¶å…³é—­ï¼ˆä»Šæ—¥ä¸èƒ½å†ç”¨ï¼‰                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ä»Šæ—¥ä½¿ç”¨      15 åˆ†é’Ÿ                         â”‚
â”‚  æœ¬å‘¨å¹³å‡      22 åˆ†é’Ÿ/å¤©                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. ç»Ÿè®¡é¡µé¢

æ–°å¢åº•éƒ¨å¯¼èˆªé¡¹ã€Œç»Ÿè®¡ã€ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç»Ÿè®¡                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ä»Šæ—¥æ€»è®¡                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚        1å°æ—¶ 32åˆ†é’Ÿ               â”‚          â”‚
â”‚  â”‚   [é¥¼å›¾: å„åº”ç”¨å æ¯”]              â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æœ¬å‘¨è¶‹åŠ¿                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚  2h â”‚     â–ˆâ–ˆ                      â”‚          â”‚
â”‚  â”‚     â”‚  â–ˆâ–ˆ â–ˆâ–ˆ â–ˆâ–ˆ                   â”‚          â”‚
â”‚  â”‚  1h â”‚  â–ˆâ–ˆ â–ˆâ–ˆ â–ˆâ–ˆ â–ˆâ–ˆ â–ˆâ–ˆ             â”‚          â”‚
â”‚  â”‚     â”‚  â–ˆâ–ˆ â–ˆâ–ˆ â–ˆâ–ˆ â–ˆâ–ˆ â–ˆâ–ˆ â–ˆâ–ˆ â–ˆâ–ˆ       â”‚          â”‚
â”‚  â”‚  0  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚          â”‚
â”‚  â”‚     ä¸€  äºŒ  ä¸‰  å››  äº”  å…­  æ—¥     â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å„åº”ç”¨ä½¿ç”¨è¯¦æƒ…                                â”‚
â”‚  æŠ–éŸ³        45åˆ†é’Ÿ  [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘] 75%       â”‚
â”‚  å¾®åš        32åˆ†é’Ÿ  [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘] 53%       â”‚
â”‚  å°çº¢ä¹¦      15åˆ†é’Ÿ  [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 25%       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[é¦–é¡µ]  [åº”ç”¨]  [ç»Ÿè®¡]  [è®¾ç½®]
```

---

## æé†’å¼¹çª—è®¾è®¡

### 80% æé†’

```kotlin
@Composable
fun UsageWarningDialog(
    appName: String,
    usedMinutes: Int,
    limitMinutes: Int,
    onContinue: () -> Unit,
    onExit: () -> Unit
) {
    AlertDialog(
        icon = { Text("â°", fontSize = 32.sp) },
        title = { Text("ä½¿ç”¨æ—¶é—´æé†’") },
        text = {
            Column {
                Text("$appName ä»Šæ—¥å·²ä½¿ç”¨ $usedMinutes åˆ†é’Ÿ")
                Text("è¿˜å‰© ${limitMinutes - usedMinutes} åˆ†é’Ÿ")
            }
        },
        confirmButton = {
            TextButton(onClick = onContinue) { Text("ç»§ç»­ä½¿ç”¨") }
        },
        dismissButton = {
            Button(onClick = onExit) { Text("é€€å‡ºåº”ç”¨") }
        }
    )
}
```

### 100% è½¯æé†’

```kotlin
@Composable
fun LimitReachedSoftDialog(
    appName: String,
    usedMinutes: Int,
    redirectApp: String?,
    onRedirect: () -> Unit,
    onContinue: () -> Unit
) {
    AlertDialog(
        icon = { Text("âš ï¸", fontSize = 32.sp) },
        title = { Text("å·²è¾¾åˆ°ä»Šæ—¥é™é¢") },
        text = {
            Column {
                Text("$appName ä»Šæ—¥å·²ä½¿ç”¨ $usedMinutes åˆ†é’Ÿ")
                Text("å»ºè®®ä¼‘æ¯ä¸€ä¸‹")
            }
        },
        confirmButton = {
            if (redirectApp != null) {
                Button(onClick = onRedirect) { Text("æ‰“å¼€$redirectApp") }
            }
        },
        dismissButton = {
            TextButton(onClick = onContinue) { Text("ç»§ç»­ä½¿ç”¨") }
        }
    )
}
```

### 100% å¼ºåˆ¶å…³é—­

```kotlin
@Composable
fun LimitReachedStrictDialog(
    appName: String,
    usedMinutes: Int,
    redirectApp: String?,
    onRedirect: () -> Unit,
    onGoHome: () -> Unit
) {
    AlertDialog(
        icon = { Text("ğŸš«", fontSize = 32.sp) },
        title = { Text("ä»Šæ—¥é™é¢å·²ç”¨å®Œ") },
        text = {
            Column {
                Text("$appName ä»Šæ—¥å·²ä½¿ç”¨ $usedMinutes åˆ†é’Ÿ")
                Text("æ˜å¤©å†è§ï¼")
            }
        },
        confirmButton = {
            if (redirectApp != null) {
                Button(onClick = onRedirect) { Text("æ‰“å¼€$redirectApp") }
            }
        },
        dismissButton = {
            TextButton(onClick = onGoHome) { Text("è¿”å›æ¡Œé¢") }
        }
    )
    // æ³¨æ„ï¼šå¼ºåˆ¶æ¨¡å¼ä¸‹æ²¡æœ‰"ç»§ç»­ä½¿ç”¨"é€‰é¡¹
}
```

---

## æƒé™éœ€æ±‚

### æ–°å¢æƒé™

```xml
<!-- ä½¿ç”¨ç»Ÿè®¡æƒé™ - ç”¨äºè·å–åº”ç”¨ä½¿ç”¨æ—¶é•¿ -->
<uses-permission android:name="android.permission.PACKAGE_USAGE_STATS"
    tools:ignore="ProtectedPermissions" />
```

### æƒé™å¼•å¯¼

åœ¨è®¾ç½®é¡µé¢æ–°å¢ UsageStats æƒé™å¼•å¯¼é¡¹ï¼š
- æ£€æµ‹æƒé™çŠ¶æ€
- æä¾›è·³è½¬åˆ°ç³»ç»Ÿè®¾ç½®çš„æŒ‰é’®

---

## æ–‡ä»¶ä¿®æ”¹æ¸…å•

| æ“ä½œ | æ–‡ä»¶è·¯å¾„ | æè¿° |
|------|---------|------|
| ä¿®æ”¹ | `MonitoredApp.kt` | æ·»åŠ  dailyLimitMinutes, limitMode å­—æ®µ |
| æ–°å¢ | `UsageRecord.kt` | ä½¿ç”¨è®°å½•å®ä½“ç±» |
| æ–°å¢ | `UsageRecordDao.kt` | ä½¿ç”¨è®°å½•æ•°æ®è®¿é—® |
| ä¿®æ”¹ | `SlowDownDatabase.kt` | æ·»åŠ  UsageRecord è¡¨å’Œ DAO |
| ä¿®æ”¹ | `SlowDownRepository.kt` | æ·»åŠ ä½¿ç”¨è®°å½•ç›¸å…³æ–¹æ³• |
| æ–°å¢ | `UsageTrackingService.kt` | åå°ä½¿ç”¨æ—¶é—´åŒæ­¥æœåŠ¡ |
| ä¿®æ”¹ | `AppMonitorService.kt` | æ·»åŠ å®æ—¶è¿½è¸ªå’Œæé†’è§¦å‘é€»è¾‘ |
| æ–°å¢ | `UsageWarningActivity.kt` | ä½¿ç”¨æ—¶é—´æé†’å¼¹çª— Activity |
| ä¿®æ”¹ | `AppListScreen.kt` | æ·»åŠ ä½¿ç”¨è¿›åº¦æ¡æ˜¾ç¤º |
| æ–°å¢ | `AppDetailScreen.kt` | åº”ç”¨è¯¦æƒ…è®¾ç½®é¡µé¢ |
| æ–°å¢ | `StatisticsScreen.kt` | ç»Ÿè®¡é¡µé¢ |
| æ–°å¢ | `StatisticsViewModel.kt` | ç»Ÿè®¡é¡µé¢ ViewModel |
| ä¿®æ”¹ | `NavGraph.kt` | æ·»åŠ æ–°é¡µé¢è·¯ç”± |
| ä¿®æ”¹ | `SettingsScreen.kt` | æ·»åŠ  UsageStats æƒé™å¼•å¯¼ |
| ä¿®æ”¹ | `PermissionHelper.kt` | æ·»åŠ  UsageStats æƒé™æ£€æµ‹æ–¹æ³• |
| ä¿®æ”¹ | `AndroidManifest.xml` | æ·»åŠ  PACKAGE_USAGE_STATS æƒé™ |

---

## å®ç°ä»»åŠ¡åˆ†è§£

### ä»»åŠ¡ 1: æ•°æ®å±‚æ‰©å±•
- ä¿®æ”¹ MonitoredApp æ·»åŠ æ–°å­—æ®µ
- åˆ›å»º UsageRecord å®ä½“å’Œ DAO
- æ›´æ–°æ•°æ®åº“ç‰ˆæœ¬å’Œè¿ç§»
- æ‰©å±• Repository

### ä»»åŠ¡ 2: ä½¿ç”¨æ—¶é—´è¿½è¸ªæœåŠ¡
- åˆ›å»º UsageTrackingService
- å®ç° UsageStats åŒæ­¥é€»è¾‘
- åœ¨ AppMonitorService ä¸­æ·»åŠ å®æ—¶è¿½è¸ª
- å®ç°æ··åˆæ¨¡å¼åˆ‡æ¢é€»è¾‘

### ä»»åŠ¡ 3: æé†’å¼¹çª—
- åˆ›å»º UsageWarningActivity
- å®ç° 80% æé†’ç•Œé¢
- å®ç° 100% è½¯æé†’ç•Œé¢
- å®ç° 100% å¼ºåˆ¶å…³é—­ç•Œé¢
- é›†æˆåˆ° AppMonitorService è§¦å‘é€»è¾‘

### ä»»åŠ¡ 4: åº”ç”¨åˆ—è¡¨ UI æ”¹è¿›
- åœ¨ AppListScreen æ·»åŠ ä½¿ç”¨è¿›åº¦æ¡
- åˆ›å»º AppDetailScreen è®¾ç½®é¡µé¢
- æ·»åŠ é™é¢è®¾ç½® UI
- æ·»åŠ è¶…æ—¶æ¨¡å¼é€‰æ‹© UI

### ä»»åŠ¡ 5: ç»Ÿè®¡é¡µé¢
- åˆ›å»º StatisticsScreen
- åˆ›å»º StatisticsViewModel
- å®ç°ä»Šæ—¥/æœ¬å‘¨/æœ¬æœˆæ•°æ®å±•ç¤º
- å®ç°ç®€å•å›¾è¡¨ï¼ˆæŸ±çŠ¶å›¾/é¥¼å›¾ï¼‰

### ä»»åŠ¡ 6: æƒé™å¤„ç†
- æ·»åŠ  UsageStats æƒé™å£°æ˜
- å®ç°æƒé™æ£€æµ‹
- åœ¨è®¾ç½®é¡µæ·»åŠ æƒé™å¼•å¯¼

---

## éªŒè¯è®¡åˆ’

1. **åŠŸèƒ½éªŒè¯**
   - ä½¿ç”¨è¢«ç›‘æ§åº”ç”¨ï¼Œè§‚å¯Ÿä½¿ç”¨æ—¶é—´æ˜¯å¦æ­£ç¡®ç´¯è®¡
   - æµ‹è¯• 80% å’Œ 100% æé†’æ˜¯å¦æŒ‰æ—¶è§¦å‘
   - æµ‹è¯•è½¯æé†’å’Œå¼ºåˆ¶å…³é—­æ¨¡å¼çš„è¡Œä¸ºå·®å¼‚

2. **è¾¹ç•Œæ¡ä»¶**
   - è·¨æ—¥æœŸï¼ˆåˆå¤œï¼‰ä½¿ç”¨æ—¶é—´é‡ç½®
   - åº”ç”¨åˆ‡æ¢æ—¶çš„æ—¶é—´è®¡ç®—
   - æ— é™åˆ¶æ¨¡å¼ä¸‹çš„è¿½è¸ª

3. **æ€§èƒ½éªŒè¯**
   - ç”µæ± æ¶ˆè€—æµ‹è¯•
   - åå°æœåŠ¡ç¨³å®šæ€§
   - æ•°æ®åº“æŸ¥è¯¢æ€§èƒ½

---

*æ–‡æ¡£åˆ›å»ºæ—¶é—´ï¼š2026-01-17*
*è®¾è®¡ä¾æ®ï¼šç”¨æˆ·éœ€æ±‚è®¨è®º*
